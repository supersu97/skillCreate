---
name: "code-modifier"
description: "修改接口或方法的代码，支持多种输入方式和自动生成单元测试。当需要修改现有代码、根据接口文档更新代码、修改第三方接口调用或自动生成单元测试时调用。"
---

# 代码修改助手

*本技能专为Claude Code设计，提供智能化的代码修改和单元测试生成功能。*

## 功能介绍

这个技能让开发者能够：

1. **智能代码修改**：根据需求修改现有接口、方法或第三方接口调用
2. **多种输入支持**：支持接口名、方法名、文件名、第三方接口方法名等多种指定方式
3. **文档驱动修改**：根据本地或在线接口文档自动更新代码
4. **精准定位修改**：精确指定要修改的位置和具体内容
5. **自动单元测试生成**：在test目录下自动查找相关测试并生成单元测试
6. **安全可靠的修改**：确保修改后的代码保持原有功能和兼容性

## 何时调用

当你遇到以下情况时，应该调用这个技能：

- 需要根据新的接口文档更新现有代码
- 需要修改某个接口中的特定第三方接口调用
- 需要为现有的接口或方法添加新功能
- 需要修复代码中的bug或安全问题
- 需要根据规范更新代码结构
- 需要为修改的代码自动生成单元测试
- 需要批量修改相关接口或方法

## 使用方法

### 基本用法

1. **指定修改目标**：支持以下四种格式指定要修改的代码：
   - **接口名**：如 `GET /api/users/:id`、`POST /api/orders`
   - **方法名**：如 `UserController.getUserById`、`OrderService.createOrder`
   - **文件名**：如 `src/api/user.js`、`src/controllers/userController.js`
   - **第三方接口方法名**：如 `PaymentService.callThirdPartyAPI`

2. **指定修改位置**：精确说明要修改的具体位置
   - 修改整个接口/方法
   - 修改接口中的某个第三方接口调用
   - 修改特定参数或返回值
   - 修改错误处理逻辑

3. **提供修改说明**：详细说明要如何修改
   - 直接提供修改要求
   - 提供接口文档链接或本地文件
   - 说明要添加、删除或修改的具体内容
   - 提供示例代码或规范
   - **注意**：请说明是否需要保持原有代码风格，或指定特定的代码风格要求

4. **指定测试生成**：是否需要自动生成单元测试
   - 自动在test目录下查找相关测试
   - 生成新的单元测试文件
   - 更新现有测试用例

5. **确认修改方案**：查看修改建议并确认执行

### 交互式修改流程

分析完成后，你可以在命令行中交互式选择修改选项：

```
修改分析完成！请选择操作：
1. 查看修改前后的代码对比
2. 只修改指定的第三方接口调用
3. 根据提供的接口文档全面更新
4. 生成/更新单元测试
5. 执行所有修改
6. 导出修改方案到文件
7. 取消修改
```

### 高级用法

#### 1. 基于接口文档的修改

```
请根据以下接口文档修改对应的代码：
接口文档链接：https://api.example.com/docs/user-api
需要修改的接口：GET /api/users/:id
修改要求：根据文档更新参数验证和响应格式
```

```
请根据本地文档文件修改代码：
文档文件：./docs/user-api.yaml
需要修改的方法：UserService.updateUser
修改要求：按照文档规范更新方法实现
```

#### 2. 修改第三方接口调用

```
请修改以下接口中的第三方接口调用：
接口：POST /api/payments
需要修改的第三方调用：PaymentGateway.processPayment
修改要求：
1. 添加重试机制，最多重试3次
2. 添加超时设置，超时时间为30秒
3. 更新错误处理，记录详细的错误日志
```

#### 3. 批量修改相关接口

```
请批量修改所有用户相关的接口：
接口模式：所有以 `/api/users/` 开头的接口
修改要求：
1. 统一添加请求日志记录
2. 统一响应格式为 { success, data, message }
3. 统一错误处理机制
```

#### 4. 自动生成单元测试

```
请为以下方法修改代码并自动生成单元测试：
方法：OrderService.calculateTotal
修改要求：添加优惠券计算逻辑
测试要求：在test目录下查找相关测试并生成新的测试用例
```

## 支持的技术栈

- **语言**：JavaScript/TypeScript、Python、Java、C#、PHP等
- **框架**：Express、Koa、Django、Flask、Spring Boot、ASP.NET等
- **数据库**：MySQL、PostgreSQL、MongoDB、Redis等
- **测试框架**：Jest、Mocha、PyTest、JUnit、PHPUnit等
- **文档格式**：OpenAPI/Swagger、Markdown、YAML、JSON等

## 修改原则

1. **保持功能不变**：确保修改后的代码保持原有核心功能
2. **向后兼容**：尽量保持向后兼容性，避免破坏现有调用
3. **代码风格一致**：保持与原有代码一致的风格、命名规范和格式
4. **代码质量**：遵循代码规范和最佳实践
5. **测试覆盖**：确保修改后的代码有充分的测试覆盖
6. **安全性**：避免引入安全漏洞和风险
7. **性能考虑**：考虑修改对性能的影响

## 单元测试生成策略

### 测试发现
1. 自动在项目的test目录下查找相关测试文件
2. 根据命名约定匹配测试文件（如userController.js → userController.test.js）
3. 分析现有测试结构和模式
4. 确定测试框架和断言库

### 测试生成
1. **新建测试文件**：如果不存在对应的测试文件
2. **更新现有测试**：如果已存在测试文件
3. **测试用例设计**：
   - 正常情况测试
   - 边界情况测试
   - 错误情况测试
   - 性能测试（如适用）
4. **测试数据准备**：生成合适的测试数据
5. **断言编写**：编写清晰的断言语句

### 测试覆盖
1. 函数/方法级别覆盖
2. 参数组合覆盖
3. 异常情况覆盖
4. 集成测试覆盖（如需要）

## 示例

### 示例1：根据接口文档修改代码

```
请根据以下OpenAPI文档修改用户注册接口：
文档内容：
```
openapi: 3.0.0
paths:
  /api/auth/register:
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, password]
              properties:
                username:
                  type: string
                  minLength: 3
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
      responses:
        '201':
          description: User created successfully
```

需要修改的文件：src/controllers/authController.js
修改的方法：register
额外要求：添加密码强度验证，密码必须包含字母和数字
自动生成单元测试：是
```

### 示例2：修改第三方接口调用

```
请修改订单服务中的支付接口调用：
文件：src/services/orderService.js
方法：processPayment
需要修改的第三方调用：StripeService.charge
修改要求：
1. 添加支付状态跟踪
2. 添加支付失败时的回退机制
3. 更新支付日志记录，包含更多详细信息
4. 添加支付超时处理（15秒超时）
生成单元测试：是，在现有测试基础上添加新的测试用例
```

### 示例3：批量修改和测试生成

```
请批量修改所有产品相关接口：
接口模式：所有包含 "product" 的接口
修改要求：
1. 统一添加分页参数支持（page, limit）
2. 统一添加查询缓存，缓存时间5分钟
3. 统一响应中添加分页信息（total, page, limit, hasNext）
生成单元测试：是，为每个修改的接口生成相应的测试
```

## 输出内容

### 修改报告
1. **修改前代码**：显示原始代码
2. **修改后代码**：显示修改后的代码
3. **修改说明**：详细说明每个修改的原因和目的
4. **代码对比**：展示修改前后的差异
5. **影响分析**：分析修改对现有功能的影响

### 测试报告
1. **测试文件位置**：生成的测试文件路径
2. **测试用例列表**：生成的测试用例说明
3. **测试覆盖率**：估计的测试覆盖率
4. **测试运行建议**：如何运行测试的建议

### 风险提示
1. **兼容性风险**：可能的兼容性问题
2. **性能影响**：对性能的潜在影响
3. **安全考虑**：需要注意的安全问题
4. **测试建议**：额外的测试建议

## 注意事项

1. **备份建议**：建议在执行修改前备份重要代码
2. **代码审查**：建议进行代码审查后再合并
3. **代码风格检查**：修改后检查代码风格是否与原有代码保持一致
4. **逐步部署**：建议逐步部署修改，监控系统稳定性
5. **监控配置**：修改后建议配置相应的监控和告警
6. **文档更新**：修改后需要更新相关文档

---

*使用本技能可以快速、安全地修改代码，并自动生成高质量的单元测试，提高开发效率和代码质量。*